<mat-sidenav-container class="app-sidenav-container">
  <!-- 抽屉：移动端菜单 -->
  <mat-sidenav #drawer="matSidenav" [mode]="'over'" class="app-sidenav" [autoFocus]="false">
    <!-- 顶部：Logo（左） + 关闭（右） -->
    <div class="sidenav-header">
      <img class="app-logo" src="logo.svg" alt="logo">
      <button type="button" mat-icon-button (click)="drawer.close()" aria-label="关闭菜单">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    @if (menuType === 'main') {
    <mat-nav-list class="app-nav-list">

      <a mat-list-item #link1="routerLinkActive" [activated]="link1.isActive"
         routerLink="/"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: true }"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>home</mat-icon>
        <span matListItemTitle>路亚鱼种</span>
      </a>

      <a mat-list-item #link2="routerLinkActive" [activated]="link2.isActive"
         routerLink="/lure/bait-types"
         routerLinkActive="is-active"
           [routerLinkActiveOptions]="{ exact: false }"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>category</mat-icon>
        <span matListItemTitle>拟饵类别</span>
      </a>


      <a mat-list-item #link3="routerLinkActive" [activated]="link3.isActive"
         routerLink="/lure/community"
         routerLinkActive="is-active"
             [routerLinkActiveOptions]="{ exact: false }"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>forum</mat-icon>
        <span matListItemTitle>交流区</span>
      </a>

    </mat-nav-list>
    }
    @if(showCommunityMenuButton&&menuType === 'community')
    {
      <mat-nav-list class="app-nav-list">

      <!-- 组：交流区主导航（来自 constants.lureCommunityNav） -->
      @for (item of constants.lureCommunityNav; track item.link) {
      <a mat-list-item #link="routerLinkActive" [activated]="link.isActive"  (click)="drawer.close()"
         [routerLink]="item.link"
         [queryParams]="item.queryParams"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: item.exact ?? false }">
        <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
        <span matListItemTitle>{{ item.label }}</span>
      </a>
      }

      @if (currentMoreItem()) {
      <a mat-list-item #link="routerLinkActive" [activated]="link.isActive" (click)="drawer.close()"
         [routerLink]="currentMoreItem()!.link"
         [queryParams]="currentMoreItem()!.queryParams"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: currentMoreItem()!.exact ?? false }">
        <mat-icon matListItemIcon>{{ currentMoreItem()!.icon }}</mat-icon>
        <span matListItemTitle>{{ currentMoreItem()!.label }}</span>
      </a>
      }

      <!-- 侧栏“更多”入口：点击后弹出菜单（保留写死逻辑） -->
      <a mat-list-item [matMenuTriggerFor]="moreMenu">
        <mat-icon matListItemIcon>more_vert</mat-icon>
        <span matListItemTitle>更多</span>
      </a>

      <mat-menu #moreMenu="matMenu">
        @for (m of constants.lureCommunityMoreNav; track m.link) {
        <a mat-menu-item
           [routerLink]="m.link"
           [queryParams]="m.queryParams"   (click)="drawer.close()">
          <mat-icon>{{ m.icon }}</mat-icon>
          <span>{{ m.label }}</span>
        </a>
        }
      </mat-menu>
      <mat-divider class="menu-divider"></mat-divider>

      <!-- 快速链接折叠标题（默认展开） -->
      <a mat-list-item
         class="quick-links-header"
         (click)="toggleQuickLinks()"
         aria-controls="quick-links-section"
         [attr.aria-expanded]="!quickLinksCollapsed()">
        <mat-icon matListItemIcon class="icon-box">
          {{ quickLinksCollapsed() ? 'chevron_right' : 'expand_more' }}
        </mat-icon>
        <span matListItemTitle>快速链接</span>
      </a>
      @if (!quickLinksCollapsed()) {
      @for (item of constants.lureCommunityQuickLinks; track item.link) {
      <a mat-list-item #link="routerLinkActive" [activated]="link.isActive"  (click)="drawer.close()"
         [routerLink]="item.link"
         [queryParams]="item.queryParams"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: item.exact ?? false }">
        <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
        <span matListItemTitle>{{ item.label }}</span>
      </a>
      }
      }
      <mat-divider class="menu-divider"></mat-divider>

      <a mat-list-item
         class="quick-links-header"
         (click)="toggleTags()"
         aria-controls="tags-section"
         [attr.aria-expanded]="!tagsCollapsed()">
        <mat-icon matListItemIcon class="icon-box">
          {{ tagsCollapsed() ? 'chevron_right' : 'expand_more' }}
        </mat-icon>
        <span matListItemTitle>标签</span>
      </a>
      @if (!tagsCollapsed()) {
       @for (item of constants.lureCommunityTags; track item.link) {
         <a mat-list-item #link="routerLinkActive" [activated]="link.isActive"  (click)="drawer.close()"
         [routerLink]="item.link"
         [queryParams]="item.queryParams"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: item.exact ?? false }">
        <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
        <span matListItemTitle>{{ item.label }}</span>
      </a>
       }
      }
    </mat-nav-list>
    }
  </mat-sidenav>
 
 
  <!-- 主内容 + 顶部导航（桌面端） -->
  <mat-sidenav-content class="utilities-background" #content>
    <header class="docs-header">
      <nav class="docs-navbar-header">


        <img class="app-logo pointer" src="logo.svg" routerLink="/" alt="logo">
        <span class="app-name text-shadow-primary ts-sm ts-subtle" routerLink="/">示例网站</span>

        <!-- 顶部导航项（带图标） -->
        <a matButton class="docs-navbar-hide-small"
           routerLink="/"
           routerLinkActive="docs-navbar-header-item-selected"
           [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>home</mat-icon>
          <span>路亚鱼种</span>
        </a>

        <a matButton class="docs-navbar-hide-small"
           routerLink="/lure/bait-types"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>category</mat-icon>
          <span>拟饵类别</span>
        </a>



        <a matButton class="docs-navbar-hide-small"
           routerLink="/lure/community"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>forum</mat-icon>
          <span>交流区</span>
        </a>

        <div class="docs-flex-spacer"></div>

        @if (authenticationService.isLoggedIn()) {

        <!-- 头像按钮：用 div 触发 mat-menu（最干净） -->
        <div class="user-avatar-btn"
             role="button"
             tabindex="0"
             aria-label="打开用户菜单"
             [matMenuTriggerFor]="userMenu"
             [matTooltip]="authenticationService.user()?.displayName ?? authenticationService.user()?.userName"
             (keydown.enter)="menuTrigger.openMenu()"
             (keydown.space)="menuTrigger.openMenu()"
             #menuTrigger="matMenuTrigger">

          @if (authenticationService.user()?.avatarUrl) {
          <img class="user-avatar-img"
               [src]="authenticationService.user()?.avatarUrl"
               alt="用户头像" />
          } @else {
          <span class="user-avatar-fallback">
            {{ getInitials(authenticationService.user()?.displayName ?? authenticationService.user()?.userName) }}
          </span>
          }
        </div>

        <!-- 用户菜单 -->
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item [routerLink]="'/account'">
            <mat-icon>person</mat-icon>
            <span>个人中心</span>
          </button>
          <button mat-menu-item [routerLink]="'/settings'">
            <mat-icon>settings</mat-icon>
            <span>设置</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>退出登录</span>
          </button>
        </mat-menu>
        } @else {
        <!-- 未登录：登录 / 注册 -->
        <a matButton [routerLink]="'/login'" [queryParams]="{ returnUrl: router.url }">
          <mat-icon>login</mat-icon>
          <span>登录</span>
        </a>
        <a matButton [routerLink]="'/register'">
          <mat-icon>person_add</mat-icon>
          <span>注册</span>
        </a>
        }
      </nav>
      <nav class="secondary-navbar-header docs-navbar-show-small">

        <button matButton class="menu-button" (click)="openMenu(drawer, 'main')">
          <mat-icon>menu</mat-icon>
          <span>主菜单</span>
        </button>
        @if(showCommunityMenuButton)
        {
          <button matButton class="community-menu-button" (click)="openMenu(drawer, 'community')">
          <mat-icon>menu</mat-icon>
          <span>交流区菜单</span>
        </button>
        }

        <div class="docs-flex-spacer"></div>


      </nav>
    </header>

    <main class="docs-homepage-promo mat-shadow-2" [class.wide-page]="showCommunityMenuButton">
      <router-outlet></router-outlet>
    </main>
    <app-footer></app-footer>
  </mat-sidenav-content>

</mat-sidenav-container>

