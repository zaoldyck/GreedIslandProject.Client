<mat-sidenav-container class="app-sidenav-container">
  <!-- 抽屉：移动端菜单 -->
  <mat-sidenav #drawer="matSidenav" [mode]="'over'" class="app-sidenav" [autoFocus]="false">
    <!-- 顶部：Logo（左） + 关闭（右） -->
    <div class="sidenav-header">
      <img class="app-logo" src="logo.svg" alt="logo">
      <button type="button" mat-icon-button (click)="drawer.close()" aria-label="关闭菜单">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <mat-nav-list class="app-nav-list">

      <a mat-list-item
         routerLink="/"
         routerLinkActive="is-active"
         [routerLinkActiveOptions]="{ exact: true }"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>home</mat-icon>
        <span matListItemTitle>首页</span>
      </a>

      <a mat-list-item
         routerLink="/spots"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>map</mat-icon>
        <span matListItemTitle>钓点地图</span>
      </a>

      <a mat-list-item
         routerLink="/techniques"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>tips_and_updates</mat-icon>
        <span matListItemTitle>路亚技巧</span>
      </a>

      <a mat-list-item
         routerLink="/lures"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>category</mat-icon>
        <span matListItemTitle>饵料库</span>
      </a>

      <a mat-list-item
         routerLink="/gear"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>build</mat-icon>
        <span matListItemTitle>装备推荐</span>
      </a>

      <a mat-list-item
         routerLink="/community"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>forum</mat-icon>
        <span matListItemTitle>社区</span>
      </a>

      <a mat-list-item
         routerLink="/events"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>event</mat-icon>
        <span matListItemTitle>活动</span>
      </a>

      <a mat-list-item
         routerLink="/guides"
         routerLinkActive="is-active"
         (click)="drawer.close()">
        <mat-icon matListItemIcon>menu_book</mat-icon>
        <span matListItemTitle>Guides</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <!-- 主内容 + 顶部导航（桌面端） -->
  <mat-sidenav-content>

    <header>
      <nav class="docs-navbar-header">
        <!-- 左侧菜单按钮 -->
        <button class="menu-button" mat-icon-button (click)="drawer.toggle()">
          <mat-icon>menu</mat-icon>
        </button>

        <img class="app-logo pointer" src="logo.svg" routerLink="/" alt="logo">
        <span class="app-name text-shadow-primary ts-sm ts-subtle" routerLink="/">路亚宝</span>

        <!-- 顶部导航项（带图标） -->
        <a mat-button class="docs-navbar-hide-small"
           routerLink="/"
           routerLinkActive="docs-navbar-header-item-selected"
           [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>home</mat-icon>
          <span>首页</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/spots"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>map</mat-icon>
          <span>钓点地图</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/techniques"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>tips_and_updates</mat-icon>
          <span>路亚技巧</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/lures"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>category</mat-icon>
          <span>饵料库</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/gear"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>build</mat-icon>
          <span>装备推荐</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/community"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>forum</mat-icon>
          <span>社区</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/events"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>event</mat-icon>
          <span>活动</span>
        </a>

        <a mat-button class="docs-navbar-hide-small"
           routerLink="/guides"
           routerLinkActive="docs-navbar-header-item-selected">
          <mat-icon>menu_book</mat-icon>
          <span>Guides</span>
        </a>

        <div class="docs-flex-spacer"></div>

        @if (authenticationService.isLoggedIn()) {

        <!-- 头像按钮：用 div 触发 mat-menu（最干净） -->
        <div class="user-avatar-btn"
             role="button"
             tabindex="0"
             aria-label="打开用户菜单"
             [matMenuTriggerFor]="userMenu"
             [matTooltip]="authenticationService.user()?.displayName ?? authenticationService.user()?.userName"
             (keydown.enter)="menuTrigger.openMenu()"
             (keydown.space)="menuTrigger.openMenu()"
             #menuTrigger="matMenuTrigger">

          @if (authenticationService.user()?.avatarUrl) {
          <img class="user-avatar-img"
               [src]="authenticationService.user()?.avatarUrl"
               alt="用户头像" />
          } @else {
          <span class="user-avatar-fallback">
            {{ getInitials(authenticationService.user()?.displayName ?? authenticationService.user()?.userName) }}
          </span>
          }
        </div>


        <!-- 用户菜单 -->
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item [routerLink]="'/account'">
            <mat-icon>person</mat-icon>
            <span>个人中心</span>
          </button>
          <button mat-menu-item [routerLink]="'/settings'">
            <mat-icon>settings</mat-icon>
            <span>设置</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>退出登录</span>
          </button>
        </mat-menu>
        } @else {
        <!-- 未登录：登录 / 注册 -->
        <a mat-button [routerLink]="'/login'" [queryParams]="{ returnUrl: router.url }">
          <mat-icon>login</mat-icon>
          <span>登录</span>
        </a>
        <a mat-button [routerLink]="'/register'">
          <mat-icon>person_add</mat-icon>
          <span>注册</span>
        </a>
        }
      </nav>
    </header>
    <main class="docs-homepage-promo">
      <router-outlet></router-outlet>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
