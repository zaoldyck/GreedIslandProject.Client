<!-- login.component.html -->
<mat-tab-group>
  <!-- 密码登录 -->
  <mat-tab label="密码登录">
    <form [formGroup]="pwdForm" (ngSubmit)="onSubmitPwd()">

      <h2>登录</h2>

      <mat-form-field appearance="outline">
        <mat-label>账号</mat-label>
        <input matInput
               formControlName="account"
               required
               autocomplete="username"
               placeholder="输入账号" />
        @if (pwdForm.controls.account.touched && pwdForm.controls.account.hasError('required')) {
        <mat-error>账号为必填</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>密码</mat-label>
        <input matInput
               [type]="showPassword() ? 'text' : 'password'"
               formControlName="password"
               required
               autocomplete="current-password"
               placeholder="输入密码" />
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="showPassword.set(!showPassword())"
                [attr.aria-label]="'切换密码可见性'">
          <mat-icon>{{ showPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (pwdForm.controls.password.touched && pwdForm.controls.password.hasError('required')) {
        <mat-error>密码为必填</mat-error>
        }
      </mat-form-field>

      <button type="submit" mat-flat-button color="primary"
              [disabled]="pwdForm.invalid || logging()">
        登录
      </button>

      <a mat-button routerLink="/register">没有账号？去注册</a>
    </form>
  </mat-tab>

  <!-- 短信登录 -->
  <mat-tab label="短信登录">
    <form [formGroup]="smsForm" (ngSubmit)="onSubmitSms()">

      <h2>手机验证码登录</h2>

      <mat-form-field appearance="outline" floatLabel="always">
        <mat-label>手机号</mat-label>
        <input matInput
               type="tel"
               formControlName="phone"
               maxlength="11"
               required
               autocomplete="tel"
               placeholder="输入手机号" />
        @if (smsForm.controls.phone.hasError('required') && smsForm.controls.phone.touched) {
        <mat-error>手机号为必填</mat-error>
        }
        @if (smsForm.controls.phone.hasError('pattern') && smsForm.controls.phone.touched) {
        <mat-error>请输入有效的大陆手机号</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" floatLabel="always">
        <mat-label>短信验证码</mat-label>
        <input matInput
               formControlName="code"
               maxlength="6"
               required
               placeholder="6位数字" />
        @if (smsForm.controls.code.hasError('required') && smsForm.controls.code.touched) {
        <mat-error>验证码为必填</mat-error>
        }
        @if (smsForm.controls.code.hasError('pattern') && smsForm.controls.code.touched) {
        <mat-error>请输入6位数字验证码</mat-error>
        }
        @if (smsForm.controls.code.hasError('server')) {
        <mat-error>{{ smsForm.controls.code.getError('server') }}</mat-error>
        }
      </mat-form-field>

      <button mat-stroked-button type="button"
              [disabled]="!canSend()"
              (click)="sendCode()">
        @if (countdown() === 0) { 获取验证码 } @else { 重新发送 {{ countdown() }}s }
      </button>

      <button type="submit" mat-flat-button color="primary"
              [disabled]="smsForm.invalid || logging()">
        登录
      </button>

      <a mat-button routerLink="/register">没有账号？去注册</a>
    </form>
  </mat-tab>
</mat-tab-group>
