<img class="app-logo pointer" src="logo.svg" routerLink="/" alt="logo">
<mat-card class="login-main-card mat-shadow-2">
  <mat-card-content class="login-grid">
    <div class="login-illustration"></div>
    <div class="login-content">
      <mat-tab-group>
        <!-- 密码登录 -->
        <mat-tab label="密码登录">
          <form [formGroup]="passwordForm" class="login-form" (ngSubmit)="loginWithPassword()">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>账号</mat-label>
              <input matInput
                     formControlName="account"
                     required
                     autocomplete="username"
                     placeholder="输入账号/手机号" />
              @if (passwordForm.controls.account.touched && passwordForm.controls.account.hasError('required')) {
              <mat-error>账号为必填</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>密码</mat-label>
              <input matInput
                     [type]="showPassword() ? 'text' : 'password'"
                     formControlName="password"
                     required
                     autocomplete="current-password"
                     placeholder="输入密码" />
              <button mat-icon-button
                      matSuffix
                      type="button"
                      (click)="showPassword.set(!showPassword())"
                      [attr.aria-label]="'切换密码可见性'">
                <mat-icon>{{ showPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (passwordForm.controls.password.touched && passwordForm.controls.password.hasError('required')) {
              <mat-error>密码为必填</mat-error>
              }
            </mat-form-field>

            <button type="submit" mat-flat-button
                    [disabled]="passwordForm.invalid || logging()">
              登录
            </button>

            <a mat-button routerLink="/register">没有账号？去注册</a>
          </form>
        </mat-tab>

        <!-- 短信登录 -->
        <mat-tab label="短信登录">

          <form [formGroup]="smsForm" class="login-form" (ngSubmit)="loginWithSms()">

            <mat-form-field appearance="outline" floatLabel="always"  >
              <mat-label>手机号</mat-label>
              <input matInput
                     type="tel"
                     inputmode="numeric"
                     formControlName="phone"
                     maxlength="11"
                     required
                     autocomplete="tel"
                     placeholder="输入大陆手机号" />
              @if (smsForm.controls.phone.hasError('required') && smsForm.controls.phone.touched) {
              <mat-error>手机号为必填</mat-error>
              }
              @if (smsForm.controls.phone.hasError('pattern') && smsForm.controls.phone.touched) {
              <mat-error>请输入有效的大陆手机号</mat-error>
              }
            </mat-form-field>

            <div class="sms-row">
              <mat-form-field appearance="outline" floatLabel="always" >
                <mat-label>短信验证码</mat-label>
                <input matInput
                       formControlName="code"
                       inputmode="numeric"
                       maxlength="6"
                       required
                       placeholder="6位数字" />
                @if (smsForm.controls.code.hasError('required') && smsForm.controls.code.touched) {
                <mat-error>验证码为必填</mat-error>
                }
                @if (smsForm.controls.code.hasError('pattern') && smsForm.controls.code.touched) {
                <mat-error>请输入6位数字验证码</mat-error>
                }
                @if (smsForm.controls.code.hasError('server')) {
                <mat-error>{{ smsForm.controls.code.getError('server') }}</mat-error>
                }
              </mat-form-field>

              <button mat-stroked-button
                      type="button"
                      class="code-btn"
                      [disabled]="!canSend()"
                      (click)="sendCode()"
                      [attr.aria-live]="'polite'">
                @if (countdown() === 0) {
                获取验证码
                } @else {
                重新发送 <span class="mono">{{ countdown() }}</span>s
                }
              </button>
            </div>

            <button type="submit" mat-flat-button 
                    [disabled]="smsForm.invalid || logging()">
              登录
            </button>

            <a mat-button routerLink="/register" class="register-link">没有账号？去注册</a>
          </form>

        </mat-tab>
      </mat-tab-group>
    </div>
  </mat-card-content>

</mat-card>


